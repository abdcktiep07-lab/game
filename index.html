<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èºçµ²èµ·é£›ï¼šæ·¨é›¶è–æ¯å‚³èªª (ISO 14064-1 RPG)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- å¾©å¤ RPG é¢¨æ ¼ UI --- */
        :root {
            --pixel-bg: #2d3748;
            --pixel-border: #4a5568;
            --pixel-accent: #48bb78; /* ç¶ è‰²ä»£è¡¨æ°¸çºŒ */
            --pixel-text: #e2e8f0;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #1a202c;
            color: var(--pixel-text);
            overflow-x: hidden;
            background-image: radial-gradient(#2d3748 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* åƒç´ å­—é«”ç”¨æ–¼æ¨™é¡Œå’Œæ•¸æ“š */
        .pixel-font {
            font-family: 'DotGothic16', sans-serif;
        }

        /* RPG å°è©±æ¡†é¢¨æ ¼ */
        .rpg-box {
            background-color: rgba(23, 42, 69, 0.95);
            border: 4px solid #cbd5e0;
            box-shadow: 0 0 0 4px #2d3748, 0 0 20px rgba(0,0,0,0.5);
            border-radius: 4px;
            position: relative;
        }

        .rpg-box::after {
            content: '';
            position: absolute;
            top: -4px; left: -4px; right: -4px; bottom: -4px;
            border: 2px solid #a0aec0;
            pointer-events: none;
            border-radius: 6px;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .rpg-btn {
            background: linear-gradient(180deg, #4299e1 0%, #2b6cb0 100%);
            border: 2px solid #bee3f8;
            color: white;
            padding: 10px 20px;
            font-family: 'DotGothic16', sans-serif;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.1s;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 4px 0 #2c5282;
            width: 100%;
            text-align: left;
            margin-bottom: 0.75rem;
        }

        .rpg-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #2c5282;
        }

        .rpg-btn:hover {
            background: linear-gradient(180deg, #63b3ed 0%, #3182ce 100%);
        }

        /* ç‹€æ…‹æ¢ */
        .status-bar {
            height: 12px;
            background: #4a5568;
            border: 2px solid #cbd5e0;
            border-radius: 10px;
            overflow: hidden;
        }
        .status-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* åœ–ç‰‡å®¹å™¨ */
        .scene-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border: 4px solid #cbd5e0;
            background-color: #000;
            image-rendering: pixelated; /* å˜—è©¦è®“åœ–ç‰‡çœ‹èµ·ä¾†æœ‰é»å¾©å¤ */
        }

        /* æ‰“å­—æ©Ÿæ•ˆæœå…‰æ¨™ */
        .cursor::after {
            content: 'â–‹';
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .term-highlight {
            color: #f6ad55;
            font-weight: bold;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-2 sm:p-4">

    <!-- ä¸»éŠæˆ²å®¹å™¨ -->
    <div class="w-full max-w-4xl mx-auto">
        
        <!-- é ‚éƒ¨ç‹€æ…‹åˆ— -->
        <div class="rpg-box p-4 mb-4 flex justify-between items-center bg-gray-900">
            <div class="flex items-center gap-4">
                <div class="pixel-font text-xl text-yellow-400">LV. <span id="player-lvl">1</span> èœé³¥ç›¤æŸ¥å“¡</div>
                <div class="hidden sm:block text-gray-400">|</div>
                <div class="text-sm">ä»»å‹™é€²åº¦ï¼š<span id="quest-name" class="text-green-400">åºç« ï¼šç¢³ç¨…å±æ©Ÿ</span></div>
            </div>
            <div class="w-1/3">
                <div class="text-xs mb-1 text-right">æ·¨é›¶è–æ¯èƒ½é‡</div>
                <div class="status-bar">
                    <div id="progress-fill" class="status-fill"></div>
                </div>
            </div>
        </div>

        <!-- éŠæˆ²ä¸»ç•«é¢å€åŸŸ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            
            <!-- å·¦å´ï¼šè¦–è¦ºå ´æ™¯ -->
            <div class="lg:col-span-2">
                <div class="rpg-box p-2 relative">
                    <!-- è¼‰å…¥å‹•ç•« -->
                    <div id="img-loader" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-900 z-10 hidden">
                        <div class="pixel-font text-2xl animate-pulse text-green-400">æ­£åœ¨ç”Ÿæˆå ´æ™¯...</div>
                        <div class="text-sm text-gray-500 mt-2">å¬å–šåƒç´ ç¹ªåœ–ç²¾éˆä¸­</div>
                    </div>
                    
                    <img id="scene-img" src="https://placehold.co/800x450/2d3748/e2e8f0?text=Screw+Lift-Off+Industries" alt="Game Scene" class="scene-image">
                    
                    <!-- æµ®å‹•æç¤ºæ–‡å­— (ä¾‹å¦‚ç²å¾—é“å…·) -->
                    <div id="notification-area" class="absolute bottom-4 left-0 right-0 text-center pointer-events-none"></div>
                </div>
            </div>

            <!-- å³å´ï¼šæ•¸æ“šèˆ‡NPCè³‡è¨Š -->
            <div class="lg:col-span-1 flex flex-col gap-4">
                <!-- NPC é ­åƒå€ -->
                <div class="rpg-box p-4 flex-1 flex flex-col items-center justify-center text-center bg-gray-800">
                    <div class="w-24 h-24 bg-gray-700 rounded-full border-4 border-yellow-600 mb-2 overflow-hidden flex items-center justify-center">
                        <span id="npc-avatar" class="text-4xl">ğŸ‘·</span>
                    </div>
                    <h3 id="npc-name" class="pixel-font text-xl text-yellow-500 font-bold">é˜¿åœŸä¼¯ (å» é•·)</h3>
                    <p id="npc-role" class="text-xs text-gray-400">èºçµ²èµ·é£›å¯¦æ¥­ - è³‡æ·±è€å°‡</p>
                    <div class="mt-4 w-full bg-gray-900 p-2 rounded text-xs text-left font-mono text-green-300">
                        > ç‹€æ…‹: <span id="factory-status">ç„¦æ…®ä¸­</span><br>
                        > è¨‚å–®: <span class="text-red-400">å±éšª</span><br>
                        > ç¢³æ’: æœªçŸ¥
                    </div>
                </div>

                <!-- é“å…·/ç­†è¨˜å€ -->
                <div class="rpg-box p-4 h-48 overflow-y-auto">
                    <h4 class="pixel-font text-lg text-blue-300 border-b border-gray-600 mb-2">ğŸ“œ ç›¤æŸ¥ç­†è¨˜</h4>
                    <ul id="inventory-list" class="text-sm space-y-1 list-disc pl-4 text-gray-300">
                        <li class="italic text-gray-500">æš«ç„¡ç­†è¨˜...</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨ï¼šå°è©±èˆ‡é¸é … -->
        <div class="mt-4 rpg-box p-6 min-h-[200px]">
            <div id="dialogue-box" class="mb-6 text-lg leading-relaxed cursor">
                <!-- å°è©±æ–‡å­—å°‡åœ¨æ­¤æ‰“å­—é¡¯ç¤º -->
            </div>
            
            <div id="choices-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4 fade-in hidden">
                <!-- æŒ‰éˆ•å°‡é€é JS ç”Ÿæˆ -->
            </div>
            
            <button id="next-btn" class="hidden absolute bottom-4 right-4 bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded border border-gray-500 pixel-font animate-bounce" onclick="gameState.next()">
                ç¹¼çºŒ â–¼
            </button>
        </div>

    </div>

    <script>
        // --- éŠæˆ²è³‡æ–™èˆ‡è…³æœ¬ ---
        
        // åœ–ç‰‡ç”Ÿæˆæç¤ºè© (Pixel Art é¢¨æ ¼)
        const prompts = {
            intro: "Pixel art style, wide shot of a traditional Taiwanese metal factory 'Screw Lift-off Industries' at sunset, industrial pipes, gloomy atmosphere, menacing dark clouds shaped like a dragon in the sky representing 'Carbon Tax', retro game aesthetic.",
            office: "Pixel art style, inside a messy factory manager office in Taiwan, old wooden desk, piles of paperwork, an old fan, a calendar on the wall, an anxious middle-aged Asian factory manager wearing a helmet looking at a paper, retro game aesthetic.",
            boundary: "Pixel art style, a factory map layout on a table, highlighting the main factory building with a glowing green magical shield (boundary), a dormitory building outside the shield, isometric view, retro game aesthetic.",
            monsters: "Pixel art style, inside a dark factory floor, spooky glowing red eyes on machinery (forklifts, air conditioners, electrical boxes) representing 'Carbon Monsters', adventurous atmosphere, retro game aesthetic.",
            calculation: "Pixel art style, a close up of a magical calculator glowing with blue light, a spellbook titled 'ISO 14064', mathematical symbols floating in the air, retro game aesthetic.",
            boss: "Pixel art style, a giant monster made of black smoke and invoices labeled 'CBAM' and 'Carbon Tax', facing a small brave worker holding a glowing green shield and sword, epic battle scene, retro game aesthetic.",
            victory: "Pixel art style, the factory is clean and bright, solar panels on the roof, blue sky, workers cheering, a golden trophy labeled 'Net Zero' shining, happy ending, retro game aesthetic."
        };

        const script = {
            0: {
                id: 0,
                type: 'story',
                text: "ã€ä¸–ç•Œè§€åºç« ã€‘\n\nè¥¿å…ƒ 2024 å¹´ï¼Œèºçµ²å¤§é™¸ï¼ˆå°ç£é«˜é›„ï¼‰çš„å¤©ç©ºè¢«ä¸€å±¤ç°è‰²çš„é™°éœ¾ç± ç½©ã€‚\n\né‚£ä¸æ˜¯éœ§éœ¾ï¼Œé‚£æ˜¯ä¾†è‡ªé™é æ­ç›Ÿçš„è©›å’’â€”â€”ã€ŒCBAM ç¢³é‚Šå¢ƒç¨…ã€ã€‚å‚³èªªä¸­ï¼Œä»»ä½•ç„¡æ³•è­‰æ˜è‡ªå·±ã€Œæ¸…ç™½ï¼ˆä½ç¢³ï¼‰ã€çš„å·¥å» ï¼Œè¨‚å–®éƒ½æœƒè¢«å‡çµï¼Œæœ€çµ‚èµ°å‘å€’é–‰çš„å‘½é‹...\n\nä½ æ˜¯ã€Œèºçµ²èµ·é£›å¯¦æ¥­ã€å‰›å ±åˆ°çš„æ°¸çºŒç®¡ç†å¸«ï¼Œä½ çš„ä»»å‹™æ˜¯æ‹¯æ•‘é€™é–“å²Œå²Œå¯å±çš„è€ç‰Œå·¥å» ã€‚",
                imgKey: 'intro',
                npc: { name: "æ—ç™½", avatar: "ğŸ“¢" },
                next: 1
            },
            1: {
                id: 1,
                type: 'dialogue',
                text: "å» é•·é˜¿åœŸä¼¯æ»¿é ­å¤§æ±—åœ°è·‘éä¾†ï¼Œæ‰‹è£¡æ®èˆè‘—ä¸€å¼µå…¨è‹±æ–‡çš„å–®å­ã€‚\n\né˜¿åœŸä¼¯ï¼šã€Œå¤­å£½å–”ï¼å°‘å¹´è€¶ï¼å®¢æˆ¶é‚£é‚Šå¯„é€™å¼µå–®å­ä¾†ï¼Œèªªä»€éº¼æˆ‘å€‘è¦ã€ç›¤æŸ¥ã€ï¼Ÿé‚„è¦ç®—ä»€éº¼ã€ç¢³ã€ï¼Ÿä¸ç„¶ä¸‹å­£ä¸çµ¦å–®äº†ï¼æˆ‘å€‘æ˜¯åšèºçµ²çš„ï¼Œåˆä¸æ˜¯è³£æœ¨ç‚­çš„ï¼Œæ˜¯è¦ç›¤ä»€éº¼ï¼Ÿã€",
                imgKey: 'office',
                npc: { name: "é˜¿åœŸä¼¯", avatar: "ğŸ‘·", role: "ç„¦æ…®çš„å» é•·" },
                next: 2
            },
            2: {
                id: 2,
                type: 'choice',
                text: "ä½ çœ‹è‘—é©šæ…Œå¤±æªçš„å» é•·ï¼Œæ±ºå®šå±•ç¾ä½ çš„å°ˆæ¥­ï¼ˆISO 14064-1ï¼‰ã€‚é¦–å…ˆï¼Œä½ éœ€è¦å‘ä»–è§£é‡‹æˆ‘å€‘ç¾åœ¨è¦åšä»€éº¼ä»»å‹™ã€‚",
                npc: { name: "ä½ ", avatar: "ğŸ§‘â€ğŸ’¼", role: "æ°¸çºŒå‹‡è€…" },
                choices: [
                    { text: "A. å» é•·åˆ¥æ€•ï¼æˆ‘å€‘è¦é€²è¡Œã€Œæº«å®¤æ°£é«”ç›¤æŸ¥ã€ï¼Œé€™å°±åƒå¹«å·¥å» åšä¸€æ¬¡å…¨èº«å¥åº·æª¢æŸ¥ï¼", target: 3, score: 10 },
                    { text: "B. é€™æ˜¯æ­ç›Ÿçš„é™°è¬€å•¦ï¼Œæˆ‘å€‘ä¸è¦ç†ä»–ï¼Œç¹¼çºŒåšæˆ‘å€‘çš„èºçµ²ã€‚", target: 99, score: -10 }
                ]
            },
            3: {
                id: 3,
                type: 'story',
                text: "é˜¿åœŸä¼¯ä¼¼æ‡‚éæ‡‚åœ°é»é»é ­ï¼šã€Œå¥åº·æª¢æŸ¥ï¼Ÿé€™æˆ‘å°±æ‡‚äº†ã€‚é‚£é†«ç”Ÿ...å–”ä¸ï¼Œé¡§å•ï¼Œæˆ‘å€‘è¦å…ˆæª¢æŸ¥å“ªè£¡ï¼Ÿã€\n\nã€ä»»å‹™ä¸€ï¼šç•«å‡ºé­”æ³•çµç•Œ (è¨­å®šçµ„ç¹”é‚Šç•Œ)ã€‘\n\næ ¹æ“š ISO 14064-1ï¼Œæˆ‘å€‘å¿…é ˆå…ˆç¢ºèªç›¤æŸ¥çš„ç¯„åœã€‚é€™å°±åƒåœ¨æˆ°å ´ä¸Šç•«å‡ºé˜²è­·ç½©ï¼Œåœˆåœ¨è£¡é¢çš„æ‰ç®—æˆ‘å€‘çš„è²¬ä»»ã€‚",
                imgKey: 'boundary',
                npc: { name: "ç³»çµ±æç¤º", avatar: "ğŸ¤–" },
                next: 4
            },
            4: {
                id: 4,
                type: 'choice',
                text: "é˜¿åœŸä¼¯æ‹¿å‡ºäº†å·¥å» çš„åœ°åœ–ï¼šã€Œå°‘å¹´è€¶ï¼Œé€™äº›éƒ½æ˜¯æˆ‘å€‘çš„åœ°ç›¤ã€‚ä½ çœ‹é€™åœˆåœˆè¦æ€éº¼ç•«ï¼Ÿã€\n\n(æç¤ºï¼šæˆ‘å€‘æ¡ç”¨ã€Œç‡Ÿé‹æ§åˆ¶æ¬Šæ³•ã€ï¼Œæˆ‘å€‘æœ‰æ¬ŠåŠ›ç®¡è½„çš„åœ°æ–¹æ‰ç®—)",
                npc: { name: "é˜¿åœŸä¼¯", avatar: "ğŸ‘·" },
                choices: [
                    { text: "A. ç•«å¤§ä¸€é»ï¼é€£éš”å£è·Ÿæˆ‘å€‘è€é—†å€ŸéŒ¢çš„ã€é˜¿ç¾æ—©é¤åº—ã€éƒ½ç®—é€²ä¾†ï¼", target: 5, score: -5 },
                    { text: "B. å°ˆæ³¨æœ¬æ¥­ï¼åŒ…å«ã€Œç¸½å» ç”¢ç·šã€èˆ‡æˆ‘å€‘ç§Ÿç”¨çš„ã€Œå¤–åŒ…å€‰åº«ã€ã€‚(å“¡å·¥å®¿èˆå› ç„¡ç®¡ç†æ¬Šæ’é™¤)", target: 6, score: 20 }
                ]
            },
            5: {
                id: 5,
                type: 'dialogue',
                text: "é˜¿åœŸä¼¯ï¼šã€Œé˜¿ç¾å§¨æœƒæ‹¿èœåˆ€è¿½æ®ºæˆ‘å€‘å§ï¼å¥¹ç…è›‹çš„ç“¦æ–¯è²»å¹²æˆ‘å€‘ä»€éº¼äº‹ï¼Ÿã€\n\n(éŒ¯èª¤ï¼ç›¤æŸ¥é‚Šç•Œæ‡‰ä»¥æˆ‘å€‘æ“æœ‰ã€Œç‡Ÿé‹æ§åˆ¶æ¬Šã€çš„è¨­æ–½ç‚ºä¸»ã€‚)",
                npc: { name: "é˜¿åœŸä¼¯", avatar: "ğŸ‘·" },
                next: 4 // é‡ä¾†
            },
            6: {
                id: 6,
                type: 'story',
                text: "ã€ä»»å‹™å®Œæˆï¼šé‚Šç•Œå·²è¨­å®šï¼ã€‘\n\nä½ æˆåŠŸåœ¨ç¸½å» èˆ‡å€‰åº«å‘¨åœæ‹‰èµ·äº†ç¶ è‰²çš„é­”æ³•çµç•Œã€‚æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘è¦é€²å…¥çµç•Œå…§éƒ¨ï¼Œå°‹æ‰¾èº²è—çš„ã€Œç¢³æ€ªç¸ã€ã€‚\n\nã€ä»»å‹™äºŒï¼šé‘‘åˆ¥æ’æ”¾æºã€‘\nISO 14064-1 å°‡æ€ªç‰©åˆ†ç‚ºä¸åŒé¡åˆ¥ï¼ˆç¯„ç–‡ï¼‰ã€‚æˆ‘å€‘è¦æ‰¾å‡ºå®ƒå€‘ä¸¦è²¼ä¸Šå°æ¢ã€‚",
                imgKey: 'monsters',
                inventory: "ç²å¾—é“å…·ï¼šçµ„ç¹”é‚Šç•Œåœ°åœ–",
                npc: { name: "ç³»çµ±æç¤º", avatar: "ğŸ¤–" },
                next: 7
            },
            7: {
                id: 7,
                type: 'choice',
                text: "ä½ èµ°åˆ°å» æˆ¿å¾Œæ–¹ï¼Œç™¼ç¾ä¸€éš»å·¨å¤§çš„éµé¾æ­£åœ¨ååé»‘ç…™ï¼ˆé‹çˆï¼‰ï¼Œé‚„æœ‰ä¸€ç¾¤éš±å½¢çš„é›»å…‰é¬¼ï¼ˆå¤–è³¼é›»åŠ›ï¼‰ã€‚\n\né˜¿åœŸä¼¯å•ï¼šã€Œé€™äº›æ€ªç¸è¦æ€éº¼åˆ†é¡å•Šï¼Ÿæˆ‘çœ‹å®ƒå€‘éƒ½é•·å¾—å¾ˆåƒ...ã€",
                npc: { name: "é˜¿åœŸä¼¯", avatar: "ğŸ‘·" },
                choices: [
                    { text: "A. å…¨éƒ¨æ··åœ¨ä¸€èµ·åšæ’’å°¿ç‰›ä¸¸...æˆ‘æ˜¯èªªï¼Œå…¨éƒ¨ç®—æˆä¸€ç¨®ç¢³æ’å°±å¥½ã€‚", target: 8, score: -5 },
                    { text: "B. åˆ†é¡å°å°ï¼é‹çˆã€å…¬å‹™è»Šæ˜¯ã€Œé¡åˆ¥ 1 (ç›´æ¥æ’æ”¾)ã€ï¼Œå°é›»çš„é›»è²»å–®æ˜¯ã€Œé¡åˆ¥ 2 (èƒ½æºé–“æ¥æ’æ”¾)ã€ã€‚", target: 9, score: 20 }
                ]
            },
            8: {
                id: 8,
                type: 'dialogue',
                text: "é˜¿åœŸä¼¯ï¼šã€Œé€™æ¨£ä¸è¡Œå•¦ï¼åˆ°æ™‚å€™æŸ¥å¸³çš„æ³•å¸«ï¼ˆæŸ¥è­‰å“¡ï¼‰ä¾†ï¼Œæˆ‘å€‘ä¼šè¢«ç•¶æ‰ï¼ã€\n\n(éŒ¯èª¤ï¼ISO 14064-1 è¦æ±‚å€åˆ†ç›´æ¥æ’æ”¾èˆ‡é–“æ¥æ’æ”¾ï¼Œé€™æ˜¯æœ€åŸºæœ¬çš„åˆ†é¡ã€‚)",
                npc: { name: "é˜¿åœŸä¼¯", avatar: "ğŸ‘·" },
                next: 7 // é‡ä¾†
            },
            9: {
                id: 9,
                type: 'story',
                text: "ã€ä»»å‹™å®Œæˆï¼šæ€ªç¸åœ–é‘‘å·²æ›´æ–°ï¼ã€‘\n\nä½ æº–ç¢ºåœ°è¾¨è­˜å‡ºäº†ï¼š\n1. ç›´æ¥æ’æ”¾é¾ (Scope 1)ï¼šå·¥å» é‹çˆã€å †é«˜æ©ŸæŸ´æ²¹ã€å†·æ°£å†·åª’(é€¸æ•£)ã€‚\n2. é–“æ¥é›»åŠ›é¬¼ (Scope 2)ï¼šå¤–è³¼é›»åŠ›ã€‚\n3. å…¶ä»–è·Ÿå±èŸ² (Scope 3)ï¼šå§”å¤–é‹è¼¸è»ŠéšŠã€å“¡å·¥é€šå‹¤ã€‚\n\nç¾åœ¨ï¼Œæˆ‘å€‘è¦é€²è¡Œæœ€å¾Œçš„æ±ºæˆ°ï¼šã€é‡åŒ–è¨ˆç®—ã€‘ã€‚",
                imgKey: 'calculation',
                inventory: "ç²å¾—é“å…·ï¼šæ’æ”¾æºæ¸…å–®",
                npc: { name: "ç³»çµ±æç¤º", avatar: "ğŸ¤–" },
                next: 10
            },
            10: {
                id: 10,
                type: 'choice',
                text: "é¢å°æŠ“åˆ°çš„æ€ªç¸ï¼Œä½ éœ€è¦è¨ˆç®—å®ƒå€‘çš„æˆ°é¬¥åŠ›ï¼ˆç¢³æ’æ”¾é‡ï¼‰ã€‚\nä½ æ‰‹ä¸Šæœ‰ä¸€æŠŠã€Œæ´»å‹•æ•¸æ“šåŠã€(ä¾‹å¦‚ï¼šç”¨äº†1000å…¬å‡æŸ´æ²¹)ï¼Œä½ éœ€è¦æ­é…ä»€éº¼æ‰èƒ½ç®—å‡ºç¢³æ’é‡ï¼Ÿ",
                npc: { name: "æœ€å¾Œè©¦ç…‰", avatar: "âš”ï¸" },
                choices: [
                    { text: "A. æ­é…ã€Œæ’æ”¾ä¿‚æ•¸é­”æ³•æ›¸ã€(Emission Factor)ã€‚å…¬å¼ï¼šæ´»å‹•æ•¸æ“š Ã— æ’æ”¾ä¿‚æ•¸ Ã— GWPå€¼ã€‚", target: 12, score: 30 },
                    { text: "B. æ­é…ã€Œè€é—†çš„ç›´è¦ºã€ã€‚è€é—†è¦ºå¾—æ’å¤šå°‘å°±æ˜¯å¤šå°‘ã€‚", target: 11, score: -10 }
                ]
            },
            11: {
                id: 11,
                type: 'dialogue',
                text: "é˜¿åœŸä¼¯ï¼šã€Œå°‘å¹´è€¶ï¼Œé›–ç„¶æˆ‘å¾ˆæƒ³èªªæˆ‘æ˜¯ç¥ï¼Œä½†æ­ç›Ÿä¸ä¿¡é€™ä¸€å¥—å•¦ï¼ã€\n\n(éŒ¯èª¤ï¼è¨ˆç®—å¿…é ˆæœ‰æ†‘æœ‰æ“šï¼Œéœ€è¦ä¾æ“šå…¬å‘Šçš„æ’æ”¾ä¿‚æ•¸ä¾†è¨ˆç®—ã€‚)",
                npc: { name: "é˜¿åœŸä¼¯", avatar: "ğŸ‘·" },
                next: 10 // é‡ä¾†
            },
            12: {
                id: 12,
                type: 'story',
                text: "ã€æœ€çµ‚æˆ°å½¹ï¼šæ“Šé€€ç¢³ç¨…é­”ç‹ã€‘\n\nä½ é«˜èˆ‰è‘—ã€Œç›¤æŸ¥å ±å‘Šæ›¸ï¼ˆè–æ¯ï¼‰ã€ï¼Œå ±å‘Šæ›¸ä¸Šè©³ç´°åˆ—å‡ºäº†èºçµ²èµ·é£›å¯¦æ¥­çš„ç¢³è¶³è·¡ã€‚\n\nç©ºä¸­çš„ç¢³ç¨…é­”ç‹ç™¼å‡ºæ€’å¼ï¼Œä½†çœ‹åˆ°ä½ å€‘ç²¾ç¢ºçš„æ•¸æ“šå’Œæœªä¾†çš„æ¸›ç¢³è¨ˆç•«ï¼ˆæ›LEDç‡ˆã€è£å¤ªé™½èƒ½ï¼‰ï¼Œé­”ç‹çš„åŠ›é‡æ¸›å¼±äº†ï¼\n\né˜¿åœŸä¼¯å¤§å–Šï¼šã€Œå°±æ˜¯ç¾åœ¨ï¼é€å‡ºé€™ä»½å ±å‘Šï¼ã€",
                imgKey: 'boss',
                inventory: "ç²å¾—é“å…·ï¼šISO 14064-1 ç›¤æŸ¥å ±å‘Šæ›¸",
                npc: { name: "åŠ‡æƒ…é«˜æ½®", avatar: "ğŸ”¥" },
                next: 13
            },
            13: {
                id: 13,
                type: 'story',
                text: "ã€é€šé—œçµå±€ï¼šèºçµ²èµ·é£›ã€‘\n\né­”ç‹æ¶ˆæ•£äº†ï¼Œæ­ç›Ÿçš„è¨‚å–®å¦‚é›ªç‰‡èˆ¬é£›ä¾†ã€‚\n\né˜¿åœŸä¼¯æ‹è‘—ä½ çš„è‚©è†€ï¼šã€Œå¥½æ¨£çš„ï¼æˆ‘å€‘ä¸åªæ˜¯åšèºçµ²ï¼Œæˆ‘å€‘ç¾åœ¨æ˜¯ã€ç¶ è‰²èºçµ²ã€äº†ï¼ã€\n\né›–ç„¶é€™åªæ˜¯ç¬¬ä¸€æ­¥ï¼ˆç›¤æŸ¥ï¼‰ï¼Œä½†ä½ å€‘å·²ç¶“æŒæ¡äº†é€šå¾€æ·¨é›¶æœªä¾†çš„é‘°åŒ™ã€‚å†’éšªé‚„åœ¨ç¹¼çºŒï¼Œä½†ä»Šå¤©ï¼Œä½ å€‘æ˜¯è‹±é›„ã€‚",
                imgKey: 'victory',
                inventory: "ç²å¾—ç¨±è™Ÿï¼šESG æ°¸çºŒå¤§å¸«",
                npc: { name: "é˜¿åœŸä¼¯", avatar: "ğŸ˜„" },
                next: null // End
            },
            99: { // Game Over logic
                id: 99,
                type: 'dialogue',
                text: "ä¸‰å€‹æœˆå¾Œï¼Œå› ç‚ºäº¤ä¸å‡ºç¢³ç›¤æŸ¥å ±å‘Šï¼Œæ­ç›Ÿå®¢æˆ¶è½‰å–®çµ¦éš”å£æœ‰åšçš„å·¥å» ã€‚èºçµ²èµ·é£›å¯¦æ¥­... å€’é–‰äº†ã€‚\n\n(è«‹æŒ‰é‡æ–°æ•´ç†å†ä¾†ä¸€æ¬¡)",
                imgKey: 'boss',
                npc: { name: "æ‚²æ…˜çµå±€", avatar: "ğŸ’€" },
                next: null
            }
        };

        // --- éŠæˆ²å¼•æ“é‚è¼¯ ---
        
        const gameState = {
            currentStage: 0,
            score: 0,
            inventory: [],
            
            init: function() {
                this.renderStage(0);
                this.updateStatus();
            },

            next: function() {
                const stage = script[this.currentStage];
                if (stage.next !== null) {
                    this.currentStage = stage.next;
                    this.renderStage(this.currentStage);
                }
            },

            choose: function(targetId, scoreChange) {
                this.score += scoreChange;
                this.currentStage = targetId;
                this.updateStatus();
                this.renderStage(this.currentStage);
            },

            updateStatus: function() {
                // æ›´æ–°ç­‰ç´šèˆ‡åˆ†æ•¸æ¢
                const lvl = Math.floor(this.score / 20) + 1;
                document.getElementById('player-lvl').innerText = lvl;
                
                // ç°¡å–®çš„é€²åº¦æ¢é‚è¼¯
                const progress = Math.min(100, Math.max(0, (this.currentStage / 13) * 100));
                document.getElementById('progress-fill').style.width = `${progress}%`;
                
                // æ›´æ–°èƒŒåŒ…
                const list = document.getElementById('inventory-list');
                if (this.inventory.length > 0) {
                    list.innerHTML = this.inventory.map(item => `<li class="text-green-300 animate-pulse">âœ¨ ${item}</li>`).join('');
                }
            },

            renderStage: async function(stageId) {
                const data = script[stageId];
                
                // 1. æ›´æ–° NPC è³‡è¨Š
                if (data.npc) {
                    document.getElementById('npc-name').innerText = data.npc.name;
                    document.getElementById('npc-avatar').innerText = data.npc.avatar;
                    if(data.npc.role) document.getElementById('npc-role').innerText = data.npc.role;
                }

                // 2. æ›´æ–°åœ–ç‰‡ (å‘¼å«ç”Ÿæˆå‡½æ•¸)
                if (data.imgKey) {
                    this.generateImage(data.imgKey);
                }

                // 3. æ›´æ–°èƒŒåŒ… (å¦‚æœæœ‰)
                if (data.inventory && !this.inventory.includes(data.inventory)) {
                    this.inventory.push(data.inventory);
                    this.updateStatus();
                    // é¡¯ç¤ºæµ®å‹•é€šçŸ¥
                    const notify = document.getElementById('notification-area');
                    notify.innerHTML = `<span class="bg-black bg-opacity-70 text-yellow-300 px-4 py-1 rounded pixel-font border border-yellow-500">${data.inventory}</span>`;
                    setTimeout(() => notify.innerHTML = '', 3000);
                }

                // 4. æ–‡å­—æ‰“å­—æ©Ÿæ•ˆæœ
                const dialogueBox = document.getElementById('dialogue-box');
                const nextBtn = document.getElementById('next-btn');
                const choicesContainer = document.getElementById('choices-container');
                
                dialogueBox.innerHTML = '';
                nextBtn.classList.add('hidden');
                choicesContainer.classList.add('hidden');
                choicesContainer.innerHTML = ''; // æ¸…ç©ºé¸é …

                let i = 0;
                const speed = 30; // æ‰“å­—é€Ÿåº¦
                
                function typeWriter() {
                    if (i < data.text.length) {
                        // è™•ç†æ›è¡Œ
                        if(data.text.charAt(i) === '\n') {
                            dialogueBox.innerHTML += '<br>';
                        } else {
                            dialogueBox.innerHTML += data.text.charAt(i);
                        }
                        i++;
                        setTimeout(typeWriter, speed);
                    } else {
                        // æ‰“å­—å®Œæˆ
                        if (data.type === 'choice') {
                            choicesContainer.classList.remove('hidden');
                            data.choices.forEach(choice => {
                                const btn = document.createElement('button');
                                btn.className = 'rpg-btn';
                                btn.innerText = choice.text;
                                btn.onclick = () => gameState.choose(choice.target, choice.score);
                                choicesContainer.appendChild(btn);
                            });
                        } else if (data.next !== null) {
                            nextBtn.classList.remove('hidden');
                        }
                    }
                }
                typeWriter();
            },

            generateImage: async function(key) {
                const loader = document.getElementById('img-loader');
                const img = document.getElementById('scene-img');
                
                // ç°¡å–®çš„å¿«å–é¿å…é‡è¤‡ç”Ÿæˆ (åœ¨çœŸå¯¦ API ä¸­å¾ˆé‡è¦)
                if (img.dataset.currentKey === key) return;
                
                loader.classList.remove('hidden');
                
                const prompt = prompts[key];
                
                try {
                    // ä½¿ç”¨ Gemini API æˆ– Imagen é€²è¡Œç”Ÿæˆçš„æ¨¡æ“¬é‚è¼¯
                    // é€™è£¡æ•´åˆäº†æ‚¨æä¾›çš„ Workflow ä¸­çš„ Image Generation é‚è¼¯
                    const apiKey = ""; // ç³»çµ±æœƒè‡ªå‹•å¡«å…¥
                    // æ³¨æ„ï¼šå¯¦éš›ç’°å¢ƒä¸­å¦‚æœæ²’æœ‰ keyï¼Œé€™æ®µæœƒå¤±æ•—ï¼Œæ‰€ä»¥æˆ‘å¢åŠ äº† fallback é‚è¼¯
                    
                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                instances: [{ prompt: prompt }],
                                parameters: { sampleCount: 1 },
                            }),
                        }
                    );

                    if (!response.ok) {
                        throw new Error("Image gen failed");
                    }

                    const result = await response.json();
                    const base64Image = result.predictions[0].bytesBase64Encoded;
                    img.src = `data:image/png;base64,${base64Image}`;
                    img.dataset.currentKey = key;

                } catch (error) {
                    console.log("Image generation fallback or error:", error);
                    // å¤±æ•—æ™‚ä½¿ç”¨ Placehold.co é¡¯ç¤ºå°æ‡‰çš„æ–‡å­—åœ–ç‰‡
                    img.src = `https://placehold.co/800x450/2d3748/e2e8f0?text=${key.toUpperCase()}+SCENE&font=roboto`;
                } finally {
                    loader.classList.add('hidden');
                }
            }
        };

        // å•Ÿå‹•éŠæˆ²
        window.onload = function() {
            gameState.init();
        };

    </script>
</body>
</html>